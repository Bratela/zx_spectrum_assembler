# ZX Spectrum Assembler

![Title image](title_image.png){height=250px}

## Как ориентироваться в машинном языке

В ЭВМ "Синклер" выбран ЦП типа Z80A, представляющий собой более быстродействующий вариант популярного типа Z80. 4 Чипа, Z80, 6502, 6809 и 8088, стали широко распространенными в качестве ЦП для микро-ЭВМ. Z80 - самый популярный из них.

Чип Z80 сконструирован таким образом, что он может принимать сигналы одновременно с восьми подсоединенных к нему контактов.

Помня о том, что на самом деле есть только электрические сигналы, давайте примем систему условных обозначений этих сигналов - например, ставя "1", если на одном из контактов есть сигнал, и "0", если сигнала нет.

Типичная команда могла бы тогда выглядеть так:
```
00111100
```
Это существенно отличается от "LET a = a + 1". Тем не менее, именно это и есть машинный язык.

## Преимущества машинных языков

- более быстрое выполнение программы;
- более эффективное использование памяти;
- более короткие программы (в памяти);
- независимость от операционной системы.

Все перечисленные выше преимущества - непосредственное следствие программирования на языке, который ЦП воспринимает без предварительной трансляции. Когда вы программируете на "бейсике", то на самом деле ЭВМ выполняет программу операционной системы, написанную на машинном языке. Эта программа выглядит примерно так:

1. NEXT взять следующую команду
2. перевести ее в последовательность команд машинного языка
3. выполнить каждую команду
4. записать результат, если это нужно
5. снова перейти на NEXT

Если вас интересует, где ЭВМ берет эту программу, операционную систему, то она хранится в ПЗУ. Иными словами, она встроена в "спектрум". (ПЗУ - сокращенное название постоянного запоминающего устройства машинной памяти, ячейки которой вы не можете менять, а можете только читать (REED/PEEKED).

Программа на языке "бейсик" может выполняться почти в 60 раз медленнее, чем программа, написанная непосредственно на машинном языке.

## Недостатки программирования на машинном языке

- программы трудно читать и отлаживать;
- их невозможно перенести на другие ЭВМ;
- программы оказываются длиннее (в командах);
- трудно выполнять арифметические вычисления.

Это означает, что вам следует очень продуманно принимать решение о том, какой метод программирования следует использовать для каждой конкретной задачи.

# Что такое язык ассемблера?

Совершенно очевидно, что если бы машинный язык можно было представлять только с помощью чисел, очень многие люди были бы способны писать программы на машинном языке.

В конце концов, кто смог бы понять смысл программы, имеющий следующий вид:
```
00100001
00000000
01000000
```
и т. д.

К счастью, мы можем придумать ряд имен для каждого из этих чисел. Язык ассемблера как раз и является таким представлением машинного языка, так что люди могут читать его в более понятной форме, чем `01111011`.

Между языком ассемблера и машинным языком есть только одно различие: язык ассемблера на один уровень выше, чем машинный язык. Его легче читать человеку, чем машинный язык, но с другой стороны, ЭВМ не может читать язык ассемблера.

## О трансляции и работе с ассемблером

Язык ассемблера может быть преобразован непосредственно в машинную программу с помощью программы или вами самими. Такая программа называется "ассемблером". Вы можете рассматривать ее как программу, выполняющую довольно утомительную задачу трансляции вашей написанной на языке ассемблера программы в последовательность команд машинного языка, понятных "спектруму" и мы считаем, что "ассемблер для ZX спектрум" уже имеется.

Тем не менее, такие ассемблеры обычно требуют 6к памяти и имеют ограниченное применение на ЭВМ с объемом памяти 16к. "Дисплей спектрум" отнимает 7к памяти, и после загрузки ассемблера у вас может остаться всего 4к памяти для программы на яз. Ассемблера.

## Шестнадцатеричная система в ZX SPECTRUM

В ZX SPECTRUM принята 16-ричная система счисления по следующим причинам:

1. Из этой формы числа легко перевести в двоичный формат, который говорит нам, что означает каждый бит
2. Он дает нам возможность легко определить, будет ли число восьмиразрядное или шестнадцатиразрядное
3. Он дает стандартное представление всех чисел в виде последовательности двухразрядных чисел
4. Это общепринятая система обозначений и знакомство с шестнадцатеричной системой позволит вам с большей легкостью читать другие книги и руководства
5. Поскольку ЦП сконструирован для обработки информации, представленной двоичными числами, которые людям читать неудобно, требуется более удобочитаемое представление

## Программа конвертации десятичных чисел в шестнадцатеричные

```basic
100 REM DECIMAL TO HEXADECIMAL CONVERSION
110 PRINT "PLEASE INPUT DECIMAL VALUE"
120 INPUT N: PRINT N
130 LET S$ ="": LET N2 = INT (N/16)
140 LET N1 = INT (N -N2*16)
150 LET S$ = CHR$ ( (N1<9) * (N1+48) + (N1>9) * (55+N1)) +S$
160 IF N2 = 0 THEN PRINT: PRINT "HEXADECIMAL = ": S$
:"H": FOR I = 1 TO 200: NEXT I: RUN
170 LET N = N2: GO TO 140
```

### Адреса важных системных областей памяти "Спектрум":

1. 16484 - Адрес начала дисплейного файла
2. 22528 - Адрес начала файла атрибутов
3. 15360 - Адрес начала набора литер
4. 15616 - Адрес начала литер в коде ASCII "спектрум"

# Как представляется информация

В представлении информации человеком и ЭВМ имеется существенная разница. У человека информация в основном состоит из чисел и литер (алфавитно-цифровая информация), тогда как вся информация в ЭВМ хранится в виде групп битов.

Бит означает двоичный разряд (BINARY DIGIT, "0" или "1"); в микропроцессоре Z80A эти биты сгруппированы по 8. Группа из восьми битов называется "байтом".

Такой способ представления информации с помощью двоичных разрядов называется "двоичным форматом". Такова структура языка, на котором разговаривает Z80 и большинство ЦП микро-ЭВМ.

В основном имеется два типа информации, представляемой внутри "спектрум". Первый - это программа, второй - данные, над которыми программа будет действовать, и которые могут включать числа или алфавитно-цифровой текст. Мы так и будем ниже рассматривать эти три представления: программа, числа, алфавитно-цифровой текст.

## Представление программы

Программа - последовательность команд ЦП выполнить конкретное задание, которое можно разбить на некоторое число "подразделений".

В Z80 все команды имеют внутреннее представление в виде одного или нескольких байтов. Команды, представленные одним байтом, называются "короткими командами". Более длинные команды представляются двумя или несколькими байтами.

Поскольку Z80 - восьмиразрядный микропроцессор, он может за один раз обрабатывать только один байт, и если ему требуется более одного, он ведет последовательный поиск байтов в памяти. Поэтому в общем случае однобайтовая команда будет выполняться быстрее, чем двух- или трехбайтовая. Таким образом, как правило выгодно писать программу на машинном языке, применяя, где можно, однобайтовые команды.

Вы можете посмотреть "короткие и длинные" команды в таблице кодов команд в приложении. Пусть вас не беспокоит, что они непонятны, позже мы рассмотрим каждую команду более глубоко.

## Числа

Каждая ячейка памяти может использоваться либо для хранения положительных целых чисел, либо целых чисел со знаком (чисел, которые могут быть и положительными и отрицательными) по вашему выбору. Диапазон чисел может быть либо от 0 до 255 либо от -128 до +127.

### Отрицательные числа

Было принято соглашение, что когда мы решаем, что в памяти будет храниться число со знаком (+ или -), применяется следующее правило:
- если бит 7 установлен, то число отрицательно
- если бит 7 не установлен, число положительно

Чтобы получить число, противоположное любому заданному числу, нужно взять "дополнение до двух" и прибавить 1.

### Дополнение до 2

Дополнение любого числа до двух - это его отрицание в двоичном формате. Любой установленный бит сбрасывается и наоборот.

# Центральный процессор

Мы говорили, что мозг "спектрум" - ЦП, процессор Z80A. Это - более быстродействующий вариант процессора Z80, производимый по лицензии фирмой "Зайлог".

Единственное отличие между процессорами Z80 и Z80A состоит в том, что первый процессор работает при частоте генератора синхроимпульсов 2 МГц (мегагерц), а второй - 4 МГц. "Частота генератора синхроимпульсов" - это простая мера скорости выполнения ЦП вычислений.

## Синхронизация процессора

В "спектрум" за секунду генерируется 3,5 миллиона синхросигналов, т.е. один синхроимпульс каждые 0,00000286 секунды.

Самая быстрая команда, выполняемая ЦП, занимает 4 синхроимпульса, а самая долгая - 21 синхроимпульс. Это означает, что даже, если будут выполняться только самые медленные команды, все равно за секунду будет выполняться около 160 000 команд!

## Физическая карта ЦП

Процессор "спектрум" - кремниевый чип с 40 контактами, пронумерованными от 1 до 40. Эти контакты - линии связи между процессором и остальной ЭВМ. Например, процессор получает питание от источника питания через контакт 11, получает синхроимпульсы через контакт 6, получает и принимает адреса через контакты с 1 по 5 и с 30 по 40 и посылает и принимает данные через контакты с 7 по 15 за исключением 11. Остальные контакты предназначены для передачи сигналов управления.

## Логическая картина ЦП

Логически Z80 можно разделить на пять функциональных частей. Это:

1. Устройство управления
2. Регистр команд
3. Счетчик команд
4. Арифметико-логическое устройство
5. 24 Регистра пользователя

### Устройство управления

Мы можем рассматривать устройство управления как некий супервизор, управляющий работой ЦП. Его задача состоит в синхронизации и координации ввода, обработки и вывода для конкретного задания, полученного ЦП вне зависимости от того, исходят ли команды из ПЗУ с записанной в нем программой или из вашей программы.

### Регистр команд

Это - регистр, используемый ЦП для хранения текущей команды, которую он собирается исполнить. Задание в целом, составляющее программу, должно находиться где-то в памяти - либо в ПЗУ, либо в памяти с произвольным доступом. Программа - это последовательность команд. Так, чтобы выполнить задание, устройство управления должно по очереди отыскивать каждую команду в памяти (либо в ПЗУ, либо в памяти с произвольным доступом) и помещать ее в регистр команд.

### Счетчик команд

Сообщает ЦП, где находится следующая часть программы (адрес следующей ячейки памяти, в которой устройство управления должно найти команду). Он подобен указателю для команд, следящему за расположением следующей команды.

### Арифметико-логическое устройство (АЛУ)

Это - калькулятор внутри ЦП. Он может выполнять как арифметические, так и логические операции. Из всех основных арифметических функций, известных нам с вами, это устройство может выполнять только простые сложение и вычитание, увеличение (добавление 1) и уменьшение (вычитание 1), но не умножение и деление. Это устройство может также сравнивать числа для одного регистра и выполнять побитовые операции, такие как перемещение битов по кругу, выставление и проверка определенных битов и т. д.

Как побочный результат вычислений, поручаемых АЛУ, обычно меняется состояние различных "флагов" в регистре FLAG. Ниже этот вопрос рассматривается более подробно.

Ниже приводится традиционный способ представления регистров пользователя:
Добавляю к предыдущему форматированию новую информацию о регистрах процессора:

## Регистры пользователя

|[]() | []() |
|----------|-----|
| A        | F   |
| B        | C   |
| D        | E   |
| H        | L   |


| []()        |
|-------------|
| IX          | 
| IY          |




Обратите внимание, что "F" соответствует "a", зато порядок остальных достаточно естественен. Причина, по которой регистры сгруппированы таким образом, состоит в том, что иногда можно из двух регистров составить пару.

IX и IY также имеют специальное название: они называются "индексными регистрами".

### Накапливающий регистр (регистр A)

Это 8-битовый регистр (однобайтовый) - самый важный в Z80. Его название восходит к первым поколениям ЭВМ, когда был лишь один регистр, применявшийся для "накопления" результата.

И хотя мы ушли вперед от первых поколений ЭВМ, накапливающий регистр по-прежнему широко применяется для логических и арифметических операций. На самом деле многие ЭВМ все еще конструируются таким образом, что многие операции можно выполнять только с помощью регистра A.

Это имеет место и для чипа Z80, и регистр a - привилегированный.

### Пара регистров

Из трех пар регистров (BC, DE, HL) пара HL, возможно, - наиболее важная. Помимо того, что пользователю предоставлен выбор, применять ли ее в виде двух отдельных регистров или как пару регистров, Z80 сконструирован таким образом, что есть определенные операции 16-битовой арифметики, которые можно выполнять только с помощью пары регистров HL.

Из-за такого привилегированного, с точки зрения аппаратуры положения, операции над парой общих регистров будут обычно быстрее выполняться для регистров HL. Из-за этого HL оказывается предпочтение в программировании на машинном языке.

### Альтернативный набор регистров

Представление всех регистров имеет вид:
```
a - F === a' - F'
B - C === B' - C'
D - e === D' - e'
H - L === H' - L'
IX
IY
```

Значения, хранимые в основных регистрах, сохраняются ЦП, пока используется альтернативный набор регистров, но к ним нельзя осуществить доступ.

### Еще регистры

"Указатель стека" - (2-байтовый регистр адреса).

Он всегда указывает, до какого размера вырос стек. С ростом стека он смещается вниз к
ячейкам памяти с меньшими номерами.

Вам обычно не приходится при программировании на машинном языке делать что-нибудь с указателем стека. За ним следит ЦП и модифицирует его каждый раз, когда вы выполняете PUSH или POP.

Обратите внимание, что часто встречается ошибка, состоящая в том, что забывают вытолкнуть назад значение, которое втолкнули в стек. Можете быть уверены, что это приведет к ситуации "CRASH" (сбой) в вашей программе.

### Регистр I

Это - регистр вектора прерывания. В системах, основанных на Z80, отличных от "спектрум" этот регистр обычно применяется для хранения базового адреса таблицы адресов для обработки различных реакций на прерывание, например, запросов ввода-вывода.

Однако, в "спектрум" это средство не применяется, и регистр I участвует в генерации сигналов управления экраном. Вряд ли вам когда-либо придется пользоваться этим регистром.

### Регистр R

Регистр R - регистр восстановления памяти. В Z80 он предназначен для автоматического обновления динамической памяти. В процессе работы процессора Z80 информация, хранимая в тех частях динамической памяти, к которым долго не было доступа, будет утекать из-за падения напряжения со временем. Если не обновлять (перезаряжать) эти ячейки памяти, то хранившаяся первоначально информация исчезает!

Регистр R служит простым счетчиком, наращиваемым каждый раз, когда происходит "цикл поиска информации в памяти". Таким образом, значение в регистре R все время циклически меняется от 0 до 255.

Этот факт может использоваться аппаратурой для обеспечения "обновления" всех частей памяти. Не нужно беспокоиться, вам ничего не нужно знать об этом. Дело господина синклера позаботиться об этом при конструировании "спектрум". Мы можем просто пользоваться его ЭВМ, не думая об обновлении и тому подобных вещах.

С точки зрения программирования вы можете считать регистр R относящимся целиком к аппаратуре и системным применениям. Однако иногда вы можете пользоваться им как средством получения случайного числа от 0 до 255. Это применение мы продемонстрируем ниже.

# Как выполнить программу на машинном языке

"ZX спектрум" на самом деле все время выполняет программы на машинном языке! (Когда он включен). Просто об этом не знаете даже когда вы ничего не делаете, просто смотрите на экран, пытаясь придумать, что ввести в качестве первой строки вашей потрясающей основы программы на языке "бейсик", ЭВМ "спектрум" занята работой под управлением программы на машинном языке.

Это одна из программ, хранимых в ПЗУ, и ее называют "операционной системой". Например, часть программы, выполняющаяся, когда вы просто сидите и смотрите на экран, выполняет следующее:
- сканирует клавиатуру в поисках введенной информации;
- отмечает, что ни одна клавиша не нажата;
- выдает на дисплей текущий экран (пустой).

Даже когда вы выполняете программу на языке "бейсик", ЦП управляется программой на машинном языке. Как мы уже объясняли, эта программа относится к типу интерпретатора - она берет вашу следующую команду языка "бейсик", преобразует ее на машинный язык, выполняет эту часть программы и затем возвращается к интерпретации следующей команды.

Все это оказывается не так, когда вы выполняете свою собственную программу на машинном языке!

Полная свобода от операционной системы! Применение функции "USR" передает управление ЦП тем командам, которые вы поместили по адресу USR, каковы бы они ни были. Что бы там ни оказалось, он будет интерпретировать это как допустимые команды машинного языка.

Продолжаю форматирование текста с сохранением структуры и добавлением разделов:

## Риски и предостережения

Перспектива довольно пугающая, ведь при потере управления вы можете потерять все, что хранилось в памяти. Одна ошибка, один неверный символ, и вам придется выключать "спектрум" и вновь начинать сначала.

Нет ни сообщений об ошибках, показывающих, где вы ошиблись, ни синтаксической проверки неверных предложений - так что если вы сделаете малейшую ошибку, будут потеряны часы работы, затраченные на ввод вашей программы.

## Первые шаги в программировании на машинном языке

В конце этой книги мы включили программу на языке "бейсик", которая позволит вам вводить и редактировать программы на машинном языке. Введя эту программу в ваш "спектрум", запишите ее на ленту, поскольку более чем вероятно, что вы по крайней мере однажды потеряете управление вашей программой на машинном языке.

С другой стороны, не бойтесь экспериментировать - вы не сможете испортить ЭВМ какой бы то ни было программой на машинном языке, вводимой вами. Самое худшее, что может произойти, - вам придется выключить и вновь включить ваш "спектрум".

### Практический пример

Сейчас мы вам для возбуждения аппетита дадим очень простую программу на машинном языке. Загрузите написанную на языке "бейсик" программу - редактор машинного языка в коде E27, помещенную в конце этой книги, и выполните ее.

Программа запросит у вас адрес загрузки. Это значит спросит у вас, где вы бы хотели разместить машинные команды. В этой программе кода вы не можете применять адреса менее 31500, так что давайте выберем 32000. Введите число 32000, затем нажмите (ENTER).

На экране теперь светится: команда или строка (# # #):

Это означает, что программа ждет, чтобы вы ввели команду или новую строку текста машинной программы.

### Ввод первой программы

Давайте введем "1", затем пробел, затем "c9" и затем "9". Это похоже на ввод строки языка бейсик с номером строки 1, но это - строка машинного языка. Если все в порядке, то нажми (ENTER). На экране теперь должны быть показаны все введенные вами строки:
1 c9 внизу экрана - подсказка "команда или строка (# # #):"

На этом этапе вы не хотите добавлять больше строк, так что давайте вместо этого введем команду.

### Проверка введенной программы

Введите слово "DUMP" и затем нажмите (ENTER). Действие этой команды состоит в выдаче текста машинной программы в виде распечатки по указанному вами адресу, а именно 32000.

Вас можно поздравить, вы только что ввели команду программы на машинном языке! Вы можете проверить, что она была введена правильно, введя теперь команду "MEM" и затем (ENTER). Эта команда позволяет вам просмотреть содержимое памяти, и она запросит у вас начальный адрес. Введите тогда 32000 и затем (ENTER).

Вы увидите содержимое ячеек памяти с 32000 по 32007. Во всех должно быть 00, за исключением 32000, в которой должно быть c9. Затем нажмите клавишу "м", чтобы вернуться на этап ввода основной команды.

### Пояснения к командам

Команда "c9" означает RETURN (возврат)!

Все это несколько напоминает езду на велосипеде в первый раз: вы действительно хотите получить самостоятельность, но как только немного проедете, хочется "вернуться" к надежности твердой земли под ногами (иными словами, операционной системы!)

### Выполнение программы

Теперь переходим к выполнению программы на машинном языке. Чтобы выполнить любую программу на машинном языке, записанную вами в память, введите команду "RUN" и затем (ENTER).

Что происходит? Почему внизу экрана появилось число 32000? Это - адрес, использованный вами в качестве адреса загрузки в начале.

Не забывайте, что функция "USR" состоит в выполнении подпрограммы на машинном языке. В частности из этой функции вытекает, что значение USR при возврате из программы на машинном языке, помещенной вами в память, будет равно значению пары регистров BC.

Ответ на этот вопрос вытекает из способа, которым операционная система "спектрум" (да, все та же самая) обращается с функцией "USR".

Когда операционная система встречает функцию "USR", она загружает указанный пользователем адрес в пару регистров BC - в данном случае 32000.

Значение "USR", как в предложении
```assembly
LET a = USR 32000
```
естественно приводит к ответу 32000!

Эта особенность функции "USR" будет очень полезна, поскольку она позволит нам следить за тем, что происходит во время выполнения программы на машинном языке.

Давайте введем следующую программу на машинном языке:

### Пример короткой программы
``` assembly
0в
c9
```

Ввести эту короткую, состоящую из двух команд, программу можно так:
1. Ввести строку 1, введя "1", затем пробел, затем "0", затем "в" и затем нажав (ENTER)
2. Аналогичным образом ввести строку 2 c9

Распечатка должна показать вам, что вы ввели строки правильно. Введите команду "DUMP" и затем команду "RUN".

На этот раз результат равен 31999! Так получилось потому, что команда "0в" - это "DEC BC" (сокращенное название для уменьшения значения BC на 1).

# Виды адресации в ZX SPECTRUM:

- непосредственная адресация;
- регистровая адресация;
- косвенная регистровая адресация;
- расширенная адресация;
- индексная адресация.

Приведенный выше список не покрывает все возможные комбинации - только те, которые относятся к числам для одного регистра. Давайте поочередно рассмотрим каждое из этих возможных видоизменений.

## Непосредственная адресация

Общая форма для нее имеет вид:
```assembly
LD R, N
```
(или иная команда - мы используем LD только в качестве примера мы используем сокращение "R" для обозначения произвольного 8-битового регистра, а "N" - для 8-битового числа.

Непосредственная адресация - это метод, использующий только один регистр. Реальные данные входят составной частью в команду; это означает, что ЦП может выполнять команду непосредственно после ее получения. Ему не приходится вести поиск дополнительной информации в памяти, чтобы выполнить эту команду.

Обычно мы применяем непосредственную адресацию для инициализации счетчиков и определения констант, необходимых для вычислений.

Непосредственную адресацию легко применять в программировании на машинном языке. Тем не менее, это - наименее гибкий из всех методов передачи информации (способов адресации), поскольку и регистр, и данные фиксируются в момент написания программы. Эквивалентное предложение на языке "бейсик" выглядело бы так: `LET a=5` очевидно, команды такого типа необходимы, но мы не могли бы писать таким способом программы целиком!

## Регистровая адресация

Мы уже кратко рассматривали этот способ. Общий вид имеет форму:
```assembly
LD R, R
```
(или другие команды) при этом методе участвуют только 2 регистра.

ЦП допускает передачу информации между любыми двумя регистрами, за исключением руки "F".

Для команд с регистровой адресацией требуется всего один байт. Команды этого типа не только коротки (один байт), они также и быстрее выполняются. Требующееся для их выполнения время составляет 4 импульса генератора синхросигналов, или менее 1 микросекунды для "спектрум".

Для написания программ на машинном языке существует "правило", что для повышения эффективности программы в плане затрат времени и памяти всегда, когда есть возможность, следует применять передачу информации регистр - регистр.

## Косвенная регистровая адресация

```assembly
LD (RR), a   или   LD a, (RR)
LD (HL), N
```

Этот богатый возможностями тип команды приводит к передаче данных между ЦП и ячейкой памяти, на которую указывает содержимое одной из 16-битовых пар.

Косвенная регистровая адресация действует быстрее, чем обычная косвенная адресация, поскольку ЦП нет необходимости извлекать адрес из памяти.

Тем не менее, мы должны сначала загрузить регистр, так что косвенная регистровая адресация дает преимущества только тогда, когда программа использует один и тот же или соседние адреса многократно.

Например:
```assembly
LD HL, SHAPE: ; загрузить начало базы данных SHAPE в HL
LOOP LD a, (HL): ; поиск данных
    INC HL:     ; дать приращение указателю
    ; продолжать LOOP пока не кончится
```

## Расширенная адресация

```assembly
LD a, (NN)   или   LD (NN), a
```

Теперь посмотрим, как происходит обмен информацией между памятью и регистрами.

При расширенной адресации команда программы предоставляет ЦП адрес, заданный двумя байтами. Если передача информации осуществляется в или из накапливающего регистра, то она повлияет только на содержимое ячейки памяти, заданной двухбайтовым целым числом.

Если же передача информации осуществляется в или из пары регистров, то она повлияет и на ячейку памяти, заданную двухбайтовым целым числом, и на следующую ячейку.

Команда такого типа имеет следующий формат:
- Байт 1: код операции
- Байт 2: (допустимый дополнительный код операции)
- Байт 3: младшие разряды 16-битового целого числа
- Байт 4: старшие разряды этого целого числа

Именно таким способом программа может считывать содержимое памяти в регистры пользователя. И вновь здесь требуется абсолютный адрес. Иными словами, в результате применения этого типа адресации программа может оказаться неперемещаемой, за исключением случаев, когда перемещаемым оказывается абсолютный адрес, на который ссылается команда.

```assembly
SHAPE DB N, N, N,...  ; база данных SHAPE
      :
      :
LD a, (SHAPE): ; загрузить первый байт в накапливающий регистр
```

## Индексная адресация

```assembly
LD R, (IX/IY+n)   или   LD (IX/IY+n), R
```
(или другие команды)

В передаче информации такого типа участвует индексный регистр IX или IY.
ЦП складывает содержимое индексного регистра с адресом, заданным в команде, чтобы найти исполнительный адрес.

Это - один из типов команд Z80, имеющих 16-битовый код операции. Другой широко применяемый 16-битовый тип команды - команда загрузки блока, например, LDIR (LOAD INCREMENT AND REPEAT- загрузить, дать приращение и повторить)

Одно из типичных применений метода адресации такого типа - выполнение табличных операций.

Индексный регистр может применяться как указатель на начало таблицы данных. Значение смещения задается в команде, чтобы определить адрес требуемого элемента таблицы, к которому нужно обратиться программе; например:
```assembly
LD IX, TABLESTART : ; инициализировать указатель на начало таблицы
LD a, (IX+3): ; обратиться к третьему байту от начала таблицы
```

Команда этого типа имеет следующий формат:
- Байт 1 (код операции)
- Байт 1 (код операции)
- Байт 2 (код операции)
- Байт 3 D: целочисленное значение смещения

Число "n" - 8-битовое число, которое необходимо задавать вместе с командой, и оно не может быть переменным. Это означает, что диапазон адресации ограничен значениями от -128 до 127 считая от адреса, заданного индексным регистром.

Индексная адресация выполняется медленнее, поскольку ЦП для получения исполнительного адреса должен выполнить сложение. И все-таки индексная адресация гораздо гибче, поскольку с помощью одной и той же команды можно обрабатывать все элементы массива или таблицы.

## Таблица команд операций загрузки для одного регистра

| MNEMONIK | BYTES | TIME TAKEN | EFFECT ON FLAGS |
|----------|-------|------------|-----------------|
| LD REGISTER, REGISTER | 1 | 4 | - - - - - - |
| LD REGISTER, NUMBER | 2 | 7 | - - - - - - |
| LD a, (ADDRESS) | 3 | 13 | - - - - - - |
| LD (ADDRESS), a | 3 | 13 | - - - - - - |
| LD REGISTER, (HL) | 1 | 7 | - - - - - - |
| LD a, (BC) | 1 | 7 | - - - - - - |
| LD a, (DC) | 1 | 7 | - - - - - - |
| LD (HL), REGISTER | 1 | 7 | - - - - - - |
| LD (BC), a | 1 | 7 | - - - - - - |
| LD (DE), a | 1 | 7 | - - - - - - |
| LD REGISTER, (IX+n) | 3 | 19 | - - - - - - |
| LD REGISTER, (IY+n) | 3 | 19 | - - - - - - |
| LD (IX+n), REGISTER | 3 | 19 | - - - - - - |
| LD (IY+n), REGISTER | 3 | 19 | - - - - - - |
| LD (HL), NUMBER | 2 | 10 | - - - - - - |
| LD (IX+n), NUMBER | 4 | 19 | - - - - - - |
| LD (IY+n), NUMBER | 4 | 19 | - - - - - - |

Где:
- MNEMONIK - мнемоническое обозначение
- BYTES - количество байтов
- TIME TAKEN - затрачиваемое время
- EFFECT ON FLAGS - состояние флагов после выполнения
- REGISTER - регистр
- NUMBER - число
- ADDRESS - адрес

### Обозначения для флагов:
- \# - указывает, что флаг меняется в результате операции
- 0 - указывает, что флаг сброшен
- 1 - указывает, что флаг установлен
- \- - указывает, что флаг остается неизменным

### Примеры команд и терминология
Остановимся подробнее на некоторых способах передачи информации:
```assembly
LD a, в
LD н, е
```
и т.д.

Напомним используемую терминологию: "LD" означает "загрузить". "," означает "в" и команда в мнемоническом виде (сокращенном) читается как русское предложение, но с обратным порядком операндов. (В оригинале, в соответствии с нормами английского языка говорится о прямом порядке операндов).

Таким образом, вслух такую, например, команду, как `LD a, в` мы прочитали бы "загрузить в В А". А следующий пример читался бы как "загрузить Е в Н".

Второй способ рассмотрим на примере:
```assembly
LD D, D7
```
(D7 - шестнадцатеричное представление 215)
